# TAKNET-PS v2.9.0 - COMPREHENSIVE UX IMPROVEMENTS

**Version:** 2.9.0  
**Date:** January 27, 2026  
**Type:** Major UX Enhancement Release  
**Status:** In Development

---

## üìã COMPLETE CHANGE LIST

### 1. Location Fields Enhancement

**Current Issues:**
- Fields show "0.0" or "0" as default values
- No format guidance for coordinates
- No validation for numeric input

**Changes:**
```html
<!-- BEFORE -->
<input type="number" step="any" id="lat" placeholder="33.5539" value="0.0">

<!-- AFTER -->
<input type="text" id="lat" placeholder="33.55390" 
       pattern="^-?\d+\.\d{1,5}$" 
       value="">
<small class="help-text">
    Format: DD.DDDDD (5 decimal places recommended)
    Example: 33.55390 for North, -117.21390 for West
</small>
```

**Implementation:**
- Remove default "0.0" values - start blank
- Change from `type="number"` to `type="text"` with pattern validation
- Add regex pattern: `^-?\d+\.\d{1,5}$` (allows negative, requires decimal)
- Add help text explaining DD.DDDDD format
- Add JavaScript validation on submit
- Longitude: Explain negative = West of Prime Meridian

**Files Modified:**
- `web/templates/setup.html` - Location step
- `web/templates/settings.html` - Settings page
- `web/static/js/setup.js` - Add validation function

---

### 2. Zip/Postal Code with Feeder Naming

**Current Behavior:**
- System estimates zip from coordinates
- Feeder name format: `ZIPCODE-YourName`
- User cannot manually specify zip code

**New Behavior:**
```
User Input Priority:
1. User enters zip code ‚Üí Use that (no estimation)
2. User leaves zip blank ‚Üí Estimate from coordinates (current behavior)

Feeder Name Format:
- User enters zip "90210" + name "Raspberry_ADSB"
- Output: "90210-Raspberry_ADSB"
- If no zip entered, estimate used: "92882-Raspberry_ADSB"
```

**UI Changes:**
```html
<!-- NEW FIELD (added before Feeder Name) -->
<div class="form-group">
    <label>Zip/Postal Code (Optional)</label>
    <input type="text" id="zip_code" 
           placeholder="90210" 
           pattern="^\d{5}(-\d{4})?$|^[A-Z]\d[A-Z] ?\d[A-Z]\d$"
           maxlength="10">
    <small class="help-text">
        Optional: Enter your zip/postal code. If left blank, 
        it will be estimated from your coordinates.
    </small>
</div>

<div class="form-group">
    <label>Feeder Name *</label>
    <input type="text" id="site_name" 
           placeholder="Raspberry_ADSB" required>
    <small class="help-text">
        Unique name for your feeder (e.g., device type, location name).
        Zip code will be prepended automatically.
    </small>
</div>
```

**Backend Logic:**
```python
# In app.py save route
zip_code = request.form.get('zip_code', '').strip()

if zip_code:
    # User provided zip - use it
    feeder_name = f"{zip_code}-{site_name}"
else:
    # Estimate zip from coordinates
    estimated_zip = estimate_zip_from_coords(lat, lon)
    feeder_name = f"{estimated_zip}-{site_name}"

# Also set as hostname
set_hostname(feeder_name)
```

**Files Modified:**
- `web/templates/setup.html` - Add zip field
- `web/templates/settings.html` - Add zip field
- `web/app.py` - Update save logic
- `web/static/js/setup.js` - Update field handling

---

### 3. Hostname and Tailscale Machine Name

**Current:** Machine name = "taknet-ps" (hardcoded)

**New:** Machine name = Feeder name (e.g., "90210-Raspberry_ADSB")

**Implementation:**
```python
def set_hostname(new_hostname):
    """Set system hostname and update Tailscale"""
    # Sanitize hostname (lowercase, replace _ with -, remove special chars)
    safe_hostname = new_hostname.lower().replace('_', '-')
    safe_hostname = ''.join(c for c in safe_hostname if c.isalnum() or c == '-')
    
    # Set system hostname
    subprocess.run(['hostnamectl', 'set-hostname', safe_hostname], check=True)
    
    # Update /etc/hosts
    with open('/etc/hosts', 'r') as f:
        hosts = f.read()
    
    hosts = re.sub(r'127\.0\.1\.1\s+.*', f'127.0.1.1    {safe_hostname}', hosts)
    
    with open('/etc/hosts', 'w') as f:
        f.write(hosts)
    
    # Update Tailscale hostname
    subprocess.run(['tailscale', 'set', '--hostname', safe_hostname], check=False)
    
    return safe_hostname
```

**Files Modified:**
- `web/app.py` - Add set_hostname function
- `install/install.sh` - Remove hardcoded hostname setup

---

### 4. Installation Complete Message

**Current:**
```
Installation Complete!
Access at: http://104.225.219.254:5001
Map: http://104.225.219.254:8080
```

**New:**
```
üéâ Installation Complete!

Access your TAKNET-PS feeder at:
  ‚Ä¢ Web Interface: http://taknet-ps.local/web
  ‚Ä¢ Aircraft Map: Accessible via dashboard

Next Steps:
1. Complete setup wizard at http://taknet-ps.local/web
2. Configure your location and feeds
3. Start tracking aircraft!
```

**Files Modified:**
- `install/install.sh` - Update final echo statements

---

### 5. Dashboard Network Status

**New Section on Dashboard:**

```html
<div class="status-card">
    <h3>Network Status</h3>
    <div class="network-info">
        <div class="status-row">
            <span class="label">Internet:</span>
            <span class="status" id="internet-status">
                <span class="indicator"></span>
                <span class="text">Checking...</span>
            </span>
        </div>
        <div class="status-row">
            <span class="label">IP Address:</span>
            <span class="value" id="ip-address">Loading...</span>
        </div>
        <div class="status-row">
            <span class="label">Hostname:</span>
            <span class="value" id="hostname">Loading...</span>
        </div>
    </div>
</div>
```

**API Endpoint:**
```python
@app.route('/api/network-status', methods=['GET'])
def api_network_status():
    """Get network connectivity status"""
    # Check internet
    has_internet = check_internet_connectivity()
    
    # Get IP address
    ip_address = get_primary_ip()
    
    # Get hostname
    hostname = socket.gethostname()
    
    return jsonify({
        'internet': has_internet,
        'ip_address': ip_address,
        'hostname': hostname
    })

def check_internet_connectivity():
    """Check if internet is accessible"""
    try:
        socket.create_connection(("8.8.8.8", 53), timeout=3)
        return True
    except:
        return False

def get_primary_ip():
    """Get primary IP address"""
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    try:
        s.connect(('8.8.8.8', 80))
        ip = s.getsockname()[0]
    except:
        ip = '127.0.0.1'
    finally:
        s.close()
    return ip
```

**Files Modified:**
- `web/templates/dashboard.html` - Add network status card
- `web/app.py` - Add network status API
- `web/static/js/dashboard.js` - Poll network status

---

### 6. Setup Wizard Internet-Dependent Services

**Current:** All services always available in wizard

**New:** Disable internet-dependent services when offline

```javascript
// In setup.js
async function checkInternetAndUpdateUI() {
    const response = await fetch('/api/network-status');
    const status = await response.json();
    
    if (!status.internet) {
        // Disable Tailscale step
        document.getElementById('tailscale-section').innerHTML = `
            <div class="warning-box">
                ‚ö†Ô∏è No Internet Connection
                <p>Tailscale requires internet. Please configure WiFi 
                   or connect Ethernet first.</p>
            </div>
        `;
        document.getElementById('tailscale_auth_key').disabled = true;
        
        // Disable FR24, ADSBX, etc.
        document.getElementById('fr24_enabled').disabled = true;
        document.getElementById('adsbx_enabled').disabled = true;
        
        // Show warning
        showWarning('Internet-dependent services disabled. Configure network first.');
    }
}
```

**Files Modified:**
- `web/static/js/setup.js` - Add internet check
- `web/templates/setup.html` - Update service sections

---

### 7. WiFi Captive Portal Manual SSID Entry

**Current:** Only scanned networks selectable

**New:** Option to manually type SSID

```html
<!-- In captive portal template -->
<div class="manual-ssid-section" style="margin-top: 20px;">
    <p style="text-align: center; color: #666;">
        Network not listed? Hidden network?
    </p>
    <button class="btn-secondary" onclick="toggleManualEntry()">
        Enter SSID Manually
    </button>
</div>

<div id="manual-entry" style="display: none; margin-top: 20px;">
    <div class="form-group">
        <label>Network Name (SSID)</label>
        <input type="text" id="manual-ssid" placeholder="MyHiddenNetwork">
    </div>
    <div class="form-group">
        <label>Password</label>
        <input type="password" id="manual-password" placeholder="Network password">
    </div>
    <div class="form-group">
        <label>Security Type</label>
        <select id="security-type">
            <option value="wpa2">WPA2/WPA3 (Most Common)</option>
            <option value="wpa">WPA</option>
            <option value="none">Open (No Password)</option>
        </select>
    </div>
    <button class="btn-primary" onclick="connectManual()">
        Connect to Network
    </button>
</div>
```

**Files Modified:**
- `install/install.sh` - Update captive portal HTML
- WiFi connection logic to handle manual entry

---

### 8. Documentation in Tarball

**Current:** Docs alongside tarball

**New:** Docs inside tarball

```
taknet-ps-complete-v2.9.0/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ CHANGELOG.md
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT-GUIDE.md       ‚Üê NEW
‚îÇ   ‚îú‚îÄ‚îÄ BUG-FIXES.md              ‚Üê NEW
‚îÇ   ‚îú‚îÄ‚îÄ UPGRADE-NOTES.md          ‚Üê NEW
‚îÇ   ‚îú‚îÄ‚îÄ PLATFORM.md
‚îÇ   ‚îî‚îÄ‚îÄ RELEASE-NOTES-v2.9.0.md   ‚Üê NEW
‚îú‚îÄ‚îÄ install/
‚îî‚îÄ‚îÄ ...
```

---

### 9. Dual Progress Bars on Loading Screen

**Current:** Single progress bar

**New:** Two concurrent progress bars

```html
<div class="progress-section">
    <div class="progress-item">
        <h3>Overall Progress</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="overall-progress"></div>
        </div>
        <p class="progress-text" id="overall-text">Initializing...</p>
    </div>
    
    <div class="progress-item">
        <h3>Current Service</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="service-progress"></div>
        </div>
        <p class="progress-text" id="service-text">Waiting...</p>
    </div>
</div>
```

**Progress Updates:**
```javascript
// Overall: 0% ‚Üí 25% ‚Üí 50% ‚Üí 75% ‚Üí 100%
// Service: Resets for each service
// 
// Example:
// Overall: 25% - "Configuring system..."
// Service: 60% - "Pulling Docker image: ultrafeeder"
```

**Files Modified:**
- `web/templates/loading.html` - Add dual progress bars
- `web/static/js/` - Update progress logic

---

### 10. Full-Screen Status Overlays

**Current:** Small message below button

**New:** Full-screen overlay with large text

```html
<div id="status-overlay" class="status-overlay" style="display: none;">
    <div class="status-content">
        <div class="spinner"></div>
        <h2 id="status-message">Saving Configuration...</h2>
        <p id="status-detail">Please wait, do not refresh the page</p>
    </div>
</div>

<style>
.status-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.status-content {
    background: white;
    padding: 60px;
    border-radius: 20px;
    text-align: center;
    max-width: 500px;
}

.spinner {
    border: 8px solid #f3f3f3;
    border-top: 8px solid #667eea;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
    margin: 0 auto 30px;
}
</style>
```

**Usage:**
```javascript
function saveConfiguration() {
    showStatusOverlay('Saving Configuration...', 'Updating services and restarting containers');
    
    // Save logic...
    
    hideStatusOverlay();
    showSuccessOverlay('Configuration Saved!', 'Proceeding to next step...');
}
```

**Files Modified:**
- `web/templates/setup.html` - Add overlay
- `web/templates/settings.html` - Add overlay
- `web/static/css/style.css` - Add overlay styles
- `web/static/js/` - Add overlay functions

---

## üì¶ FILES REQUIRING CHANGES

### Core Files
1. `web/templates/setup.html` - Major changes (location, zip, overlays)
2. `web/templates/settings.html` - Location, zip, overlays
3. `web/templates/dashboard.html` - Network status card
4. `web/templates/loading.html` - Dual progress bars
5. `web/app.py` - Hostname, network status APIs, validation
6. `web/static/js/setup.js` - Validation, internet check, overlays
7. `web/static/js/dashboard.js` - Network status polling
8. `web/static/css/style.css` - Overlay styles, network status
9. `install/install.sh` - Remove hardcoded hostname, update completion message, captive portal manual SSID

### Documentation Structure
```
docs/
‚îú‚îÄ‚îÄ DEPLOYMENT-GUIDE.md
‚îú‚îÄ‚îÄ BUG-FIXES-v2.9.0.md
‚îú‚îÄ‚îÄ UPGRADE-NOTES-v2.9.0.md
‚îú‚îÄ‚îÄ PLATFORM.md
‚îî‚îÄ‚îÄ RELEASE-NOTES-v2.9.0.md
```

---

## üß™ TESTING CHECKLIST

- [ ] Location fields start blank
- [ ] Coordinate validation works (rejects letters)
- [ ] Zip code optional, prepends to name
- [ ] Hostname changes to feeder name
- [ ] Tailscale gets correct machine name
- [ ] Installation message shows DNS names
- [ ] Dashboard shows network status
- [ ] Dashboard shows IP address
- [ ] No internet = services disabled in wizard
- [ ] Manual SSID entry works in captive portal
- [ ] Dual progress bars update correctly
- [ ] Status overlays display properly
- [ ] All docs inside tarball

---

## üöÄ DEPLOYMENT PRIORITY

**HIGH PRIORITY:**
1. Location field validation (breaks setup if invalid)
2. Zip code / feeder naming (core functionality)
3. Hostname updates (Tailscale identification)

**MEDIUM PRIORITY:**
4. Network status display (user awareness)
5. Internet-dependent service disabling (prevents errors)
6. Status overlays (better UX)

**LOW PRIORITY:**
7. Manual SSID entry (edge case)
8. Dual progress bars (cosmetic)
9. Docs in tarball (organizational)

---

This is a MAJOR release requiring careful implementation and testing.
